CREATE DATABASE QUANLYNHANVIEN

CREATE TABLE NHANVIEN
(
	MANV INT IDENTITY(1,1) PRIMARY KEY,
	MAPHONG VARCHAR(6),
	MALUONG VARCHAR(10),
	HOTEN NVARCHAR(70),
	NGAYSINH DATETIME,
	GIOITINH NVARCHAR(4),
	DANTOC NVARCHAR(50),
	CMND_CCCD VARCHAR(12),
	NOICAP NVARCHAR(20),
	CHUCVU NVARCHAR(25),
	MALOAINV VARCHAR(10),
	LOAIHD NVARCHAR(20),
	THOIGIAN INT,
	NGAYKY DATETIME,
	NGAYHETHAN DATETIME,
	SDT VARCHAR(10),
	HOCVAN NVARCHAR(20),
	GHICHU NVARCHAR(60)
)

CREATE TABLE LSCHINHSUA
(
	MACS INT IDENTITY(1,1) PRIMARY KEY,
	MANV INT,
	LANCS INT,
	MAPHONG VARCHAR(6),
	MALUONG VARCHAR(10),
	HOTEN NVARCHAR(70),
	NGAYSINH DATETIME,
	GIOITINH NVARCHAR(4),
	DANTOC NVARCHAR(50),
	CMND_CCCD VARCHAR(12),
	NOICAP NVARCHAR(20),
	CHUCVU NVARCHAR(25),
	MALOAINV VARCHAR(10),
	LOAIHD NVARCHAR(20),
	THOIGIAN INT,
	NGAYKY DATETIME,
	NGAYHETHAN DATETIME,
	SDT VARCHAR(10),
	HOCVAN NVARCHAR(20),
	GHICHU NVARCHAR(60),
	NGAYCHINHSUA DATETIME
)

CREATE TABLE LOAINHANVIEN
(
	MALOAINV VARCHAR(10) PRIMARY KEY,
	TENLOAINV NVARCHAR(30),
	MUCLUONGCOBAN MONEY,
)

CREATE TABLE PHONGBAN
(
	MAPHONG VARCHAR(6) PRIMARY KEY,
	MABP VARCHAR(8),
	TENPHONG NVARCHAR(20),
	NGAYTHANHLAP DATETIME,
	GHICHU NVARCHAR(70)
)

CREATE TABLE BOPHAN
(
	MABP VARCHAR(8) PRIMARY KEY,
	TENBOPHAN NVARCHAR(20),
	NGAYTHANHLAP DATETIME,
	GHICHU NVARCHAR(70)
)

CREATE TABLE HOSOTHUVIEC
(
	MANVTV INT IDENTITY(1,1) PRIMARY KEY,
	HOTEN NVARCHAR(70),
	NGAYSINH DATETIME,
	GIOITINH NVARCHAR(4),
	CMND_CCCD VARCHAR(12),
	NOICAP NVARCHAR(20),
	VITRITHUVIEC NVARCHAR(25),
	NGAYTV DATETIME,
	SOTHANGTV INT,
	SDT VARCHAR(10),
	HOCVAN NVARCHAR(20),
	GHICHU NVARCHAR(60)
)

CREATE TABLE BANGCHAMCONGTHUVIEC
(
	MANVTV INT,
	THANG INT,
	NAM INT,
	PRIMARY KEY (MANVTV, THANG, NAM),
	SONGAYCONG INT,
	SONGAYNGHI INT,
	SOGIOLAMTHEM INT,
	LUONGTV MONEY,
	GHICHU NVARCHAR(60)
)

CREATE TABLE BANGCHAMCONG
(
	MANV INT,
	THANG INT,
	NAM INT,
	PRIMARY KEY (MANV, THANG, NAM),
	MALUONG VARCHAR(10),
	TIENKHENTHUONG MONEY,
	TIENKYLUAT MONEY,
	SONGAYCONG INT,
	SONGAYNGHI INT,
	SOGIOLAMTHEM INT,
	GHICHU NVARCHAR(60)
)

CREATE TABLE BAOCAOLUONG
(
	THANG INT,
	NAM INT,
	TONGTIEN MONEY,
	PRIMARY KEY (THANG, NAM),
	GHICHU NVARCHAR(50)
)

CREATE TABLE LICHSUVANGMAT
(
	MANV INT,
	NGAYNGHI DATETIME,
	PRIMARY KEY (MANV, NGAYNGHI),
	GHICHU NVARCHAR(50)
)

CREATE TABLE LICHSUCHAMCONG
(
	MALSCHAMCONG INT IDENTITY(1,1) PRIMARY KEY,
	MANV INT,
	NGAYCHAMCONGGANNHAT DATETIME,
	GHICHU NVARCHAR(50)
)

CREATE TABLE KHENTHUONG
(
	MAKT INT IDENTITY(1,1) PRIMARY KEY,
	TIEN MONEY,
	LYDO NVARCHAR(50)
)

CREATE TABLE KYLUAT
(
	MAKL INT IDENTITY(1,1) PRIMARY KEY,
	TIEN MONEY,
	LYDO NVARCHAR(50)
)

CREATE TABLE BANGLUONG
(
	MALUONG VARCHAR(10) PRIMARY KEY,
	LCB MONEY,
	PHUCAPCHUCVU MONEY,
	PHUCAPKHAC MONEY,
	GHICHU NVARCHAR(80)
)

CREATE TABLE BANGTINHLUONG
(
	MANV INT,
	LUONG MONEY,
	THANG INT,
	NAM INT,
	PRIMARY KEY (MANV, THANG, NAM),
	GHICHU NVARCHAR(80)
)

CREATE TABLE THAYDOIBANGLUONG
(
	MANV INT,
	MALUONG VARCHAR(10),
	MALUONGMOI VARCHAR(10),
	PRIMARY KEY (MANV, MALUONG, MALUONGMOI),
	NGAYSUA DATETIME,
	LYDO NVARCHAR(70)
)

CREATE TABLE SOBH
(
	MABH INT IDENTITY(1,1) PRIMARY KEY,
	MANV INT,
	NGAYCAPSO DATETIME,
	NOICAPSO NVARCHAR(20),
	GHICHU NVARCHAR(70),
)

CREATE TABLE SOTHAISAN
(
	MATS INT IDENTITY(1,1) PRIMARY KEY,
	MANV INT,
	NGAYVESOM DATETIME,
	NGAYNGHISINH DATETIME,
	NGAYLAMTROLAI DATETIME,
	TROCAPCTY MONEY,
	GHICHU NVARCHAR(70)
)

CREATE TABLE NVTHOIVIEC
(
	MANV INT PRIMARY KEY,
	HOTEN NVARCHAR(70),
	CMND_CCCD VARCHAR(12),
	NGAYTHOIVIEC DATETIME,
	LYDO NVARCHAR(50)
)

CREATE TABLE TAIKHOAN
(
	MATK INT IDENTITY(1,1) PRIMARY KEY,
	MALOAITK INT,
	TENCHUTAIKHOAN NVARCHAR(20),
	TENDANGNHAP VARCHAR(20),
	MATKHAU VARCHAR(90),
)

CREATE TABLE PHANLOAITAIKHOAN
(
	MALOAITK INT IDENTITY(1,1) PRIMARY KEY,
	TENLOAITK NVARCHAR(20),
	QUYENHAN NVARCHAR(50)
)

CREATE TABLE NHANVIENHIENTAI
(
	MANV INT PRIMARY KEY,
)

CREATE TABLE THAMSO
(
	MATHAMSO VARCHAR(4) PRIMARY KEY,
	TENTHAMSO NVARCHAR(20),
	GIATRI FLOAT
)

ALTER TABLE TAIKHOAN ADD CONSTRAINT FK_TAIKHOAN_MALOAITK FOREIGN KEY (MALOAITK) REFERENCES PHANLOAITAIKHOAN(MALOAITK)

ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_MALOAINV FOREIGN KEY (MALOAINV) REFERENCES LOAINHANVIEN(MALOAINV)
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_MAPHONG FOREIGN KEY (MAPHONG) REFERENCES PHONGBAN(MAPHONG)
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_MALUONG  FOREIGN KEY (MALUONG) REFERENCES BANGLUONG(MALUONG)

ALTER TABLE PHONGBAN ADD CONSTRAINT FK_PHONGBAN_MABP FOREIGN KEY (MABP) REFERENCES BOPHAN(MABP)

ALTER TABLE BANGCHAMCONGTHUVIEC ADD CONSTRAINT FK_BANGCHAMCONGTHUVIEC_MANVTV FOREIGN KEY (MANVTV) REFERENCES HOSOTHUVIEC(MANVTV)

ALTER TABLE BANGCHAMCONG ADD CONSTRAINT FK_BANGCHAMCONG_MALUONG FOREIGN KEY (MALUONG) REFERENCES BANGLUONG(MALUONG)

ALTER TABLE THAYDOIBANGLUONG ADD CONSTRAINT FK_THAYDOIBANGLUONG_MALUONG FOREIGN KEY (MALUONG) REFERENCES BANGLUONG(MALUONG)
ALTER TABLE THAYDOIBANGLUONG ADD CONSTRAINT FK_THAYDOIBANGLUONG_MALUONGMOI FOREIGN KEY (MALUONGMOI) REFERENCES BANGLUONG(MALUONG)

SET DATEFORMAT DMY

INSERT INTO PHANLOAITAIKHOAN(TENLOAITK, QUYENHAN) VALUES (N'Quản trị viên', N'Quản trị hệ thống')
INSERT INTO PHANLOAITAIKHOAN(TENLOAITK, QUYENHAN) VALUES (N'Quản lý', N'Quản lý nhân viên')
INSERT INTO PHANLOAITAIKHOAN(TENLOAITK, QUYENHAN) VALUES (N'Nhân viên', N'Nhân viên')

INSERT INTO TAIKHOAN(MALOAITK, TENCHUTAIKHOAN, TENDANGNHAP, MATKHAU) VALUES (1,'ADMIN', 'ADMIN', '6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b')
INSERT INTO TAIKHOAN(MALOAITK, TENCHUTAIKHOAN, TENDANGNHAP, MATKHAU) VALUES (2,'MANAGER', 'MANAGER', '6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b')

INSERT INTO BOPHAN(MABP, TENBOPHAN, NGAYTHANHLAP) VALUES ('IT', N'CNTT', '01/01/2021')
INSERT INTO BOPHAN(MABP, TENBOPHAN, NGAYTHANHLAP) VALUES ('DS', N'Thiết kế', '01/01/2021')

INSERT INTO PHONGBAN(MAPHONG, MABP, TENPHONG, NGAYTHANHLAP) VALUES ('IT01', 'IT', N'CNTT 01', '05/01/2021')
INSERT INTO PHONGBAN(MAPHONG, MABP, TENPHONG, NGAYTHANHLAP) VALUES ('IT02', 'IT', N'CNTT 02', '05/01/2021')
INSERT INTO PHONGBAN(MAPHONG, MABP, TENPHONG, NGAYTHANHLAP) VALUES ('DS01', 'DS', N'Thiết kế 01', '05/01/2021')
INSERT INTO PHONGBAN(MAPHONG, MABP, TENPHONG, NGAYTHANHLAP) VALUES ('DS02', 'DS', N'Thiết kế 02', '05/01/2021')

INSERT INTO LOAINHANVIEN(MALOAINV, TENLOAINV, MUCLUONGCOBAN) VALUES ('NV', N'Nhân viên', 15000000)
INSERT INTO LOAINHANVIEN(MALOAINV, TENLOAINV, MUCLUONGCOBAN) VALUES ('TP', N'Trưởng phòng', 25000000)
INSERT INTO LOAINHANVIEN(MALOAINV, TENLOAINV, MUCLUONGCOBAN) VALUES ('GD', N'Giám đốc', 50000000)

INSERT INTO HOSOTHUVIEC(HOTEN, NGAYSINH, GIOITINH, CMND_CCCD, NOICAP, VITRITHUVIEC, NGAYTV, SOTHANGTV, SDT, HOCVAN, GHICHU) VALUES (N'Nguyễn Văn A', '01/01/2002', N'Nam', '123456789', 'BD', N'Editor', '01/10/2022', '5', '0123456789', N'Master', N'GHICHU')
INSERT INTO HOSOTHUVIEC(HOTEN, NGAYSINH, GIOITINH, CMND_CCCD, NOICAP, VITRITHUVIEC, NGAYTV, SOTHANGTV, SDT, HOCVAN, GHICHU) VALUES (N'Nguyễn Thị B', '04/04/1999', N'Nữ', '987654321', 'BD', N'Content Maker', '01/10/2022', '5', '0123456789', N'Engineer', N'GHICHU')

INSERT INTO BANGCHAMCONGTHUVIEC(MANVTV, THANG, NAM, SONGAYCONG, SONGAYNGHI, SOGIOLAMTHEM, LUONGTV) VALUES (1, 10, 2022, 26, 0, 12, 5000000)
INSERT INTO BANGCHAMCONGTHUVIEC(MANVTV, THANG, NAM, SONGAYCONG, SONGAYNGHI, SOGIOLAMTHEM, LUONGTV) VALUES (2, 10, 2022, 24, 2, 4, 5000000)

INSERT INTO BANGLUONG(MALUONG, LCB, PHUCAPCHUCVU, PHUCAPKHAC) VALUES ('Luong01', 15000000, 1000000, 1000000)
INSERT INTO BANGLUONG(MALUONG, LCB, PHUCAPCHUCVU, PHUCAPKHAC) VALUES ('Luong02', 25000000, 2000000, 2000000)
INSERT INTO BANGLUONG(MALUONG, LCB, PHUCAPCHUCVU, PHUCAPKHAC) VALUES ('Luong03', 50000000, 10000000, 10000000)

INSERT INTO NHANVIEN(MAPHONG, MALUONG, HOTEN, NGAYSINH, GIOITINH, DANTOC, CMND_CCCD, NOICAP, CHUCVU, MALOAINV, LOAIHD, THOIGIAN, NGAYKY, NGAYHETHAN, SDT, HOCVAN, GHICHU) VALUES ('IT01', 'Luong03', N'Nguyễn Gia Bảo', '05/11/2002', N'Nam', N'Kinh', '123456789', 'BD', N'Boss', 'GD', N'Dài hạn', '10', '01/01/2021', '01/01/2031', '0123456789', N'Master', N'GHICHU')
INSERT INTO NHANVIEN(MAPHONG, MALUONG, HOTEN, NGAYSINH, GIOITINH, DANTOC, CMND_CCCD, NOICAP, CHUCVU, MALOAINV, LOAIHD, THOIGIAN, NGAYKY, NGAYHETHAN, SDT, HOCVAN, GHICHU) VALUES ('IT01', 'Luong02', N'Nguyễn Huỳnh Gia Huy', '08/11/2002', N'Nam', N'Kinh', '2345678890', 'BD', N'Trưởng phòng IT01', 'TP', N'Dài hạn', '4', '01/01/2021', '01/01/2025', '0987654321', N'Master', N'GHICHU')
INSERT INTO NHANVIEN(MAPHONG, MALUONG, HOTEN, NGAYSINH, GIOITINH, DANTOC, CMND_CCCD, NOICAP, CHUCVU, MALOAINV, LOAIHD, THOIGIAN, NGAYKY, NGAYHETHAN, SDT, HOCVAN, GHICHU) VALUES ('IT02', 'Luong02', N'Đặng Đình Dũng', '05/06/2002', N'Nam', N'Kinh', '345678901', 'BD', N'Trưởng phòng IT02', 'TP', N'Dài hạn', '4', '01/01/2021', '01/01/2025', '0987456321', N'Master', N'GHICHU')
INSERT INTO NHANVIEN(MAPHONG, MALUONG, HOTEN, NGAYSINH, GIOITINH, DANTOC, CMND_CCCD, NOICAP, CHUCVU, MALOAINV, LOAIHD, THOIGIAN, NGAYKY, NGAYHETHAN, SDT, HOCVAN, GHICHU) VALUES ('DS01', 'Luong02', N'Ngô Quang Khoa', '01/01/1995', N'Nam', N'Kinh', '456789012', 'BD', N'Trưởng phòng DS01', 'TP', N'Dài hạn', '4', '01/01/2021', '01/01/2025', '0987456123', N'Master', N'GHICHU')
INSERT INTO NHANVIEN(MAPHONG, MALUONG, HOTEN, NGAYSINH, GIOITINH, DANTOC, CMND_CCCD, NOICAP, CHUCVU, MALOAINV, LOAIHD, THOIGIAN, NGAYKY, NGAYHETHAN, SDT, HOCVAN, GHICHU) VALUES ('DS02', 'Luong02', N'Lê Ngọc Như', '18/09/2002', N'Nữ', N'Kinh', '567890123', 'BD', N'Trưởng phòng DS02', 'TP', N'Dài hạn', '4', '01/01/2021', '01/01/2025', '0987456132', N'Master', N'GHICHU')
INSERT INTO NHANVIEN(MAPHONG, MALUONG, HOTEN, NGAYSINH, GIOITINH, DANTOC, CMND_CCCD, NOICAP, CHUCVU, MALOAINV, LOAIHD, THOIGIAN, NGAYKY, NGAYHETHAN, SDT, HOCVAN, GHICHU) VALUES ('DS01', 'Luong01', N'Lê Thanh Như', '01/01/1996', N'Nữ', N'Kinh', '567890123', 'BD', N'Nhân viên', 'TP', N'Dài hạn', '3', '01/01/2022', '01/01/2025', '0987456132', N'Master', N'GHICHU')

INSERT INTO KHENTHUONG(TIEN, LYDO) VALUES (2000000, N'Thực hiện tốt project')
INSERT INTO KHENTHUONG(TIEN, LYDO) VALUES (10000000, N'Thực hiện tốt nhiệm vụ cả năm')

INSERT INTO KYLUAT(TIEN, LYDO) VALUES (500000, N'Trễ deadline')
INSERT INTO KYLUAT(TIEN, LYDO) VALUES (500000, N'Đi trễ')

INSERT INTO SOBH(MANV, NGAYCAPSO, NOICAPSO) VALUES (1, '01/01/2021', N'BD')
INSERT INTO SOBH(MANV, NGAYCAPSO, NOICAPSO) VALUES (2, '01/01/2022', N'BD')
INSERT INTO SOBH(MANV, NGAYCAPSO, NOICAPSO) VALUES (3, '01/01/2022', N'BD')
INSERT INTO SOBH(MANV, NGAYCAPSO, NOICAPSO) VALUES (4, '01/01/2022', N'BD')

INSERT INTO THAMSO VALUES ('TS01',N'Số ngày nghỉ tối đa',3)
INSERT INTO THAMSO VALUES ('TS02',N'Số ngày làm tối đa',26)
INSERT INTO THAMSO VALUES ('TS03',N'Tiền làm thêm',40000)
INSERT INTO THAMSO VALUES ('TS04',N'Tỉ lệ phạt',0.3)
INSERT INTO THAMSO VALUES ('TS05',N'Số tháng nghỉ sinh',6)

INSERT INTO LICHSUCHAMCONG(MANV, NGAYCHAMCONGGANNHAT) VALUES ('3', '23/12/2022')
INSERT INTO LICHSUCHAMCONG(MANV, NGAYCHAMCONGGANNHAT) VALUES ('5', '30/6/2022')
INSERT INTO LICHSUCHAMCONG(MANV, NGAYCHAMCONGGANNHAT) VALUES ('6', '29/12/2022')


GO
CREATE FUNCTION [dbo].[fChuyenCoDauThanhKhongDau](@inputVar NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS
BEGIN    
    IF (@inputVar IS NULL OR @inputVar = '')  RETURN ''
   
    DECLARE @RT NVARCHAR(MAX)
    DECLARE @SIGN_CHARS NCHAR(256)
    DECLARE @UNSIGN_CHARS NCHAR (256)
 
    SET @SIGN_CHARS = N'ăâđêôơưàảãạáằẳẵặắầẩẫậấèẻẽẹéềểễệếìỉĩịíòỏõọóồổỗộốờởỡợớùủũụúừửữựứỳỷỹỵýĂÂĐÊÔƠƯÀẢÃẠÁẰẲẴẶẮẦẨẪẬẤÈẺẼẸÉỀỂỄỆẾÌỈĨỊÍÒỎÕỌÓỒỔỖỘỐỜỞỠỢỚÙỦŨỤÚỪỬỮỰỨỲỶỸỴÝ' + NCHAR(272) + NCHAR(208)
    SET @UNSIGN_CHARS = N'aadeoouaaaaaaaaaaaaaaaeeeeeeeeeeiiiiiooooooooooooooouuuuuuuuuuyyyyyAADEOOUAAAAAAAAAAAAAAAEEEEEEEEEEIIIIIOOOOOOOOOOOOOOOUUUUUUUUUUYYYYYDD'
 
    DECLARE @COUNTER int
    DECLARE @COUNTER1 int
   
    SET @COUNTER = 1
    WHILE (@COUNTER <= LEN(@inputVar))
    BEGIN  
        SET @COUNTER1 = 1
        WHILE (@COUNTER1 <= LEN(@SIGN_CHARS) + 1)
        BEGIN
            IF UNICODE(SUBSTRING(@SIGN_CHARS, @COUNTER1,1)) = UNICODE(SUBSTRING(@inputVar,@COUNTER ,1))
            BEGIN          
                IF @COUNTER = 1
                    SET @inputVar = SUBSTRING(@UNSIGN_CHARS, @COUNTER1,1) + SUBSTRING(@inputVar, @COUNTER+1,LEN(@inputVar)-1)      
                ELSE
                    SET @inputVar = SUBSTRING(@inputVar, 1, @COUNTER-1) +SUBSTRING(@UNSIGN_CHARS, @COUNTER1,1) + SUBSTRING(@inputVar, @COUNTER+1,LEN(@inputVar)- @COUNTER)
                BREAK
            END
            SET @COUNTER1 = @COUNTER1 +1
        END
        SET @COUNTER = @COUNTER +1
    END
    -- SET @inputVar = replace(@inputVar,' ','-')
    RETURN @inputVar
END
GO